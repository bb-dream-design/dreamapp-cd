//Установка прометеус

wget https://github.com/prometheus/prometheus/releases/download/v2.19.2/prometheus-2.19.2.linux-amd64.tar.gz
tar xf prometheus-*.tar.gz
cd prometheus-2.19.2.linux-amd64/
sudo cp prometheus promtool /usr/local/bin
sudo mkdir /etc/prometheus /var/lib/prometheus
sudo cp prometheus.yml /etc/prometheus
sudo useradd --no-create-home --home-dir / --shell /bin/false prometheus
sudo chown -R prometheus:prometheus /var/lib/prometheus

// в /etc/systemd/system/prometheus.service

cd /etc/systemd/system/
sudo touch prometheus.service
sudo nano prometheus.service

====
[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Restart=on-failure
ExecStart=/usr/local/bin/prometheus \
  --config.file /etc/prometheus/prometheus.yml \
  --storage.tsdb.path /var/lib/prometheus/
ExecReload=/bin/kill -HUP $MAINPID
ProtectHome=true
ProtectSystem=full

[Install]
WantedBy=default.target
====

sudo systemctl daemon-reload
sudo systemctl start prometheus
sudo systemctl status prometheus
sudo systemctl enable prometheus

// Установка node_exporter

wget https://github.com/prometheus/node_exporter/releases/download/v1.0.1/node_exporter-1.0.1.linux-amd64.tar.gz
tar xf node_exporter-*.tar.gz
cd node_exporter-1.0.1.linux-amd64/
sudo cp node_exporter /usr/local/bin
sudo useradd --no-create-home --home-dir / --shell /bin/false node_exporter


// в /etc/systemd/system/node_exporter.service
cd /etc/systemd/system/
sudo touch node_exporter.service
sudo nano node_exporter.service

================
[Unit]
Description=Prometheus Node Exporter
After=network.target

[Service]
Type=simple
User=node_exporter
Group=node_exporter
ExecStart=/usr/local/bin/node_exporter

SyslogIdentifier=node_exporter
Restart=always

PrivateTmp=yes
ProtectHome=yes
NoNewPrivileges=yes

ProtectSystem=strict
ProtectControlGroups=true
ProtectKernelModules=true
ProtectKernelTunables=yes

[Install]
WantedBy=multi-user.target
======

sudo systemctl daemon-reload
sudo systemctl start node_exporter
sudo systemctl status node_exporter

sudo systemctl enable node_exporter

===

// Grafana

sudo apt-get install -y adduser libfontconfig1
wget https://dl.grafana.com/oss/release/grafana_7.0.6_amd64.deb
sudo dpkg -i grafana_7.0.6_amd64.deb

sudo systemctl daemon-reload
sudo systemctl start grafana-server
sudo systemctl status grafana-server

sudo systemctl enable grafana-server.service

--

// после изменения конфига в /etc/prometheus.yml
sudo systemctl reload prometheus

ссылки
https://docs.docker.com/engine/install/ubuntu/
https://laurvas.ru/prometheus-p1/
(https://github.com/stefanprodan/dockprom)
https://habr.com/ru/post/308610/

UPD

Графана прометеус - в докере

при развертывании на новом хосте
необходимо
1 Установить докер и докер композ
2 сгенерировать ключи ssh для гитхаб и добавить публичный ключ
// ssh-keygen -t rsa -C "email"
3 склонировать репозиторий в /home/ubuntu
4 создать именованные вольюмы для графаны и прометея (имена в докер-композ файле)
// sudo docker volume create
5 изменить адреса хоста в .travis файле (перекодировать ключ достпупа при необходимости)
6 Запустить джобу cd
7 на прокси изменить proxy_pass в сторону нового сервера

PS дашборд для node_exporter - 1860